<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name='impact-site-verification' value='ce0401b0-3251-4782-b63d-1e8f0e5f9a93'>
    <meta charset="UTF-8" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dress Tile Search</title>
    <style>
      :root {
        --bg-color: #f0f0f0; /* Light mode background */
        --text-color: #000; /* Light mode text */
        --button-bg-color: #007bff; /* Button background */
        --button-text-color: #fff; /* Button text color */
      }
      [data-theme="dark"] {
        --bg-color: #333; /* Dark mode background */
        --text-color: #fff; /* Dark mode text */
        --button-bg-color: #0056b3; /* Button background for dark mode */
        --button-text-color: #fff; /* Button text color for dark mode */
      }
      body,
      html {
        /* height: 100%; */
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: var(--bg-color);
        color: var(--text-color);
        transition: background-color 0.3s, color 0.3s;
      }

      .parent-container {
        display: flex;
        flex-direction: column; /* Add this line */
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      .grid-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* Always three columns */
        padding: min(0.5vw, (2/3) * 0.5vh);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
        background: white;
        --grid-width: min(80vw, (2/3) * 80vh);
        width: var(--grid-width);
        height: calc(var(--grid-width) * 1.5)-3 * min(0.5vw, (2/3) * 0.5vh);
        margin: auto; /* Center the grid horizontally */
        justify-content: center; /* Center the child horizontally */
        align-items: center; /* Center the child vertically */
      }

      .grid-item img {
        width: 100%; /* Full width */
        height: auto; /* Auto height to maintain aspect ratio */
        object-fit: contain; /* This will cover the area, could also use 'contain' */
        border-radius: 5%;
      }
      .grid-item {
        display: flex;
        width: min(90vw, (2/3) * 90vh) / 3; /* Full width */
        padding: min(0.5vw, (2/3) * 0.5vh);
        justify-content: center;
        align-items: center;
        /* outline:black solid 2px;  */
      }

      .grid-item button {
        background-color: var(--button-bg-color);
        color: var(--button-text-color);
        border: none;
        width: 80%; /* Adjust size within grid item */
        height: 80%; /* Adjust size within grid item, maintaining square shape */
        cursor: pointer;
        border-radius: 5px;
        transition: background-color 0.3s, transform 0.2s, color 0.3s;
      }
      .grid-item button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .button-link {
        display: inline-block;
        background-color: var(--button-bg-color);
        color: var(--button-text-color);
        border: none;
        width: 80%;
        height: 80%;
        cursor: pointer;
        border-radius: 5px;
        transition: background-color 0.3s, transform 0.2s, color 0.3s;
        text-align: center;
        line-height: 2.5; /* Adjust based on your design needs */
        text-decoration: none;
      }

      .button-link:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .search-container {
        --widthe: min(80vw, (2/3) * 80vh)-10px;
        width: var(--widthe); /* Use the same width as the grid container */
        text-align: center;
        margin-top: 20px;
        align-self: end;
      }

      #search-input {
        --this-width: min(80vw, (2/3) * 80vh);
        width: var(--this-width);
        padding: 10px;
        margin: auto; /* Center the slider */
        font-size: 14px;
        border-radius: 5px;
        border: 1px solid #ccc;
        align-self: flex-end;
      }

      .zoom-container {
        --grid-width: min(80vw, (2/3) * 80vh);
        text-align: center;
        width: var(--grid-width);
        /* align-self: flex-end; Aligns the item at the top of the container */
      }

      #zoom-slider {
        width: 100%;
        margin: auto; /* Center the slider */
        margin-bottom: 20px;
      }

      .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 10px;
        cursor: pointer;
        background-color: var(--button-bg-color);
        color: var(--button-text-color);
        border: none;
        border-radius: 5px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div class="parent-container">
      <div class="search-container">
        <input
          type="text"
          id="search-input"
          placeholder="Your journey to the perfect outfit starts here..."
          onkeydown="if(event.key === 'Enter' || event.keyCode === 13) {searchItems(this.value); this.value='';}"
          />
      </div>
      <div class="grid-container">
        {% for link, vector, index in items %}
        <div
          class="grid-item"
          onclick="queryVector('{{ vector|tojson|safe }}','{{ index }}')"
          data-vector="{{ vector }}"
          position = "{{ index }}"
        >
          <img src="{{ link }}" alt="Dress {{ loop.index }}" />
        </div>
        {% else %}
        <div class="grid-item">No dresses found.</div>
        {% endfor %}
      </div>
      <div class="zoom-container">
        <input
          type="range"
          id="zoom-slider"
          min="0"
          max="5"
          step="0.01"
          value="0"
          onchange="reZoom()"
        />
      </div>
    </div>

    <!-- <button class="theme-toggle" onclick="toggleTheme()">Light Mode</button> -->

    <script>
      function reZoom(){
        var zoomSlider = document.getElementById("zoom-slider");
        var zoomValue = parseInt(zoomSlider.value);

        event.preventDefault();
        const gridItems = document.querySelectorAll(".grid-item");
        const fifthGridItem = gridItems[4];
        const dataVector = fifthGridItem.getAttribute('data-vector');
        const vector = dataVector;
        const pos = 4;
        fetch("/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ vector: JSON.parse(vector), history: JSON.parse(dataVector), position: JSON.parse(pos), zoom:JSON.parse(zoomValue)}),
        })
          .then((response) => response.json())
          .then((items) => {
            const gridContainer = document.querySelector(".grid-container");
            gridContainer.innerHTML = "";

            items.forEach((item,index) => {
              const gridItem = document.createElement("div");
              gridItem.className = "grid-item";
              gridItem.onclick = function () {
                queryVector(JSON.stringify(item.vector),index);
              };
              gridItem.setAttribute("data-vector", JSON.stringify(item.vector));
              gridItem.setAttribute("position",index)
              const image = document.createElement("img");
              image.src = item.link;
              image.alt = "DRESS";
              gridItem.appendChild(image);
              gridContainer.appendChild(gridItem);
            });
          })
          .catch((error) => {
            console.error("Error querying vector:", error);
          });
      }

      function searchItems(query) {
        console.log("Search")
        event.preventDefault(); // Prevent default link navigation
        fetch("/search", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ query: query }),
        })
          .then((response) => response.json())
          .then((items) => {
            // Assuming you have a container with the class 'grid-container'
            const gridContainer = document.querySelector(".grid-container");
            // Clear existing items
            gridContainer.innerHTML = "";

            // Add new items
            items.forEach((item,index) => {
              const gridItem = document.createElement("div");
              gridItem.className = "grid-item";
              gridItem.onclick = function () {
                queryVector(JSON.stringify(item.vector),index);
              };
              gridItem.setAttribute("data-vector", JSON.stringify(item.vector));
              gridItem.setAttribute("position", index);

              const image = document.createElement("img");
              image.src = item.link;
              image.alt = "DRESS";
              gridItem.appendChild(image);
              gridContainer.appendChild(gridItem);
            });
          })
          .catch((error) => {
            console.error("Error querying vector:", error);
          });
      }

      function queryVector(vector,pos) {
        var zoomSlider = document.getElementById("zoom-slider");
        var zoomValue = parseInt(zoomSlider.value);

        const gridItems = document.querySelectorAll(".grid-item");
        const fifthGridItem = gridItems[4];
        const dataVector = fifthGridItem.getAttribute('data-vector');
        
        if(pos == 4){
          if(zoomValue == 5){
            const imgSrc = fifthGridItem.querySelector("img").getAttribute("src"); // Get the source of the image
            const productId = imgSrc.match(/(\d+)\.jpg$/)[1]; // Extract the product ID from the image URL
            const productPageUrl = `https://www.lulus.com/products/${productId}.html`; // Construct the product page URL
            window.open(productPageUrl, '_blank'); // Open the product page link in a new tab
          }
          var newValue = zoomValue+1; // Set the new value here
          zoomSlider.value = newValue;
        }

        event.preventDefault();
        fetch("/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ vector: JSON.parse(vector), history: JSON.parse(dataVector), position: JSON.parse(pos), zoom:JSON.parse(zoomValue)}),
        })
          .then((response) => response.json())
          .then((items) => {
            // Assuming you have a container with the class 'grid-container'
            const gridContainer = document.querySelector(".grid-container");
            // Clear existing items
            gridContainer.innerHTML = "";

            // Add new items
            items.forEach((item,index) => {
              const gridItem = document.createElement("div");
              gridItem.className = "grid-item";
              gridItem.onclick = function () {
                queryVector(JSON.stringify(item.vector),index);
              };
              gridItem.setAttribute("data-vector", JSON.stringify(item.vector));
              gridItem.setAttribute("position",index)
              const image = document.createElement("img");
              image.src = item.link;
              image.alt = "DRESS";
              gridItem.appendChild(image);
              gridContainer.appendChild(gridItem);
            });
          })
          .catch((error) => {
            console.error("Error querying vector:", error);
          });
      }
      
      
      
      document.addEventListener('DOMContentLoaded', function () {
    
        const gridContainer = document.querySelector('.grid-container');
    
    // Prevent the default right-click menu and open the image link in a new tab
    gridContainer.addEventListener('contextmenu', function(event) {
        event.preventDefault(); // Prevent the default context menu
        if (event.target.tagName === 'IMG') { // Check if the clicked element is an image
            const imgSrc = event.target.src; // Get the source of the image
            const productId = imgSrc.match(/(\d+)\.jpg$/)[1]; // Extract the product ID from the image URL
            const productPageUrl = `https://www.lulus.com/products/${productId}.html`; // Construct the product page URL
            window.open(productPageUrl, '_blank'); // Open the product page link in a new tab
        }
    }, false);
});



      document.addEventListener(
        "wheel",
        function (e) {
          e.preventDefault();
          determineScrollDirection(e.deltaX, e.deltaY);
        },
        { passive: false }
      );

      var lastSwipeTime = 0; // Step 1: Declare a variable to keep track of the last swipe time

      function determineScrollDirection(deltaX, deltaY) {
        const currentTime = Date.now(); // Get the current time in milliseconds
        if (currentTime - lastSwipeTime < 1500) {
          console.log("Swipe too fast, waiting for timeout."); // Optional: Log a message or handle this case as needed
          return; // Exit the function to prevent the swipe action
        }

        const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);
        const gridContainer = document.querySelector(".grid-container");
        grid = Array.from(gridContainer.children);
        let direction = "";
        if (angle >= -22.5 && angle < 22.5) {
          direction = "East";
          queryVector(grid[5].getAttribute("data-vector"),5);
        } else if (angle >= 22.5 && angle < 67.5) {
          direction = "SE";
          queryVector(grid[8].getAttribute("data-vector"),8);
        } else if (angle >= 67.5 && angle < 112.5) {
          direction = "South";
          queryVector(grid[7].getAttribute("data-vector"),7);
        } else if (angle >= 112.5 && angle < 157.5) {
          direction = "SW";
          queryVector(grid[6].getAttribute("data-vector"),6);
        } else if (angle >= -67.5 && angle < -22.5) {
          direction = "NE";
          queryVector(grid[2].getAttribute("data-vector"),2);
        } else if (angle >= -112.5 && angle < -67.5) {
          direction = "North";
          queryVector(grid[1].getAttribute("data-vector"),1);
        } else if (angle >= -157.5 && angle < -112.5) {
          direction = "NW";
          queryVector(grid[0].getAttribute("data-vector"),0);
        } else {
          direction = "West";
          queryVector(grid[3].getAttribute("data-vector"),3);
        }
        console.log("You scrolled in direction: " + direction);
        lastSwipeTime = currentTime; // Update the last swipe time after a successful swipe
      }
    </script>

    <!-- <script>
    function toggleTheme() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        if (currentTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'light');
            document.querySelector('.theme-toggle').textContent = 'Dark Mode';
        } else {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.querySelector('.theme-toggle').textContent = 'Light Mode';
        }
    }
</script> -->
  </body>
</html>
